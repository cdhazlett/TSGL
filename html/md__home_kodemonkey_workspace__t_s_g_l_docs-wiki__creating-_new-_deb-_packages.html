<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>TSGL: Creating-New-Deb-Packages</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TSGL
   </div>
   <div id="projectbrief">A thread-safe graphics library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Creating-New-Deb-Packages </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>***WORK IN PROGRESS!!!*** </p>
<hr/>
 <h2>| HOW TO CREATE NEW TSGL DEBIAN PACKAGES FOR UBUNTU (Last updated: 07/21/16) | </h2>
<p>(Example of making the same package for a different distro: tsgl (1.1-1~&lt;distro-name&gt;) &lt;distro-name&gt;</p>
<p>***NOTE:*** This document guides you in the process of creating Debian packages by hand. The package creation process has already been automated, so you do not need to follow this document if the automation process is working fine. If, however, the automation process has failed and you need to make an RPM package by hand, please continue to read the document. DO NOT ATTEMPT TO CREATE A DEBIAN PACKAGE BY HAND IF THE AUTOMATION PROCESS IS STILL FUNCTIONAL!!!</p>
<p>***NOTE:*** This document attempts to guide you in the process of Debian package creation. Given that, package creation can be a long and complex process. If there's something that we missed, or perhaps have misleading information, please edit this page accordingly!</p>
<p>Hello!</p>
<p>So, you need to make a new Debian package for TSGL.</p>
<p>Package creation isn't trivial, and has a steep learning curve.</p>
<p>What's more, we think that creating a Debian package is a ***LOT*** more complex than creating an RPM package.</p>
<p>The reason? Instead of having to keep track of one file (SPEC file), you have to keep track of multiple.</p>
<p>Luckily, this document will attempt to guide you through the process.</p>
<p>Let's get started with a brief intro to Debian packages. </p>
<hr/>
 <h2>| Creating Debian packages: intro | </h2>
<p>Before we can even begin to talk about how to build a Debian package, we need to know what's inside one.</p>
<p>So, what exactly is inside of a Debian package?</p>
<p>Magic? Close.</p>
<p>There are three components to a Debian package:</p>
<p>1). Upstream tarball - the original source code for the library/application. This comes from developers "upstream", which means that they are the original authors of the code.</p>
<p>2). Source package - has all of the necessary files needed to compile/build the software. Includes: the upstream tarball with .tar.gz ending, a description file (.dsc), and a tarball with any changes made to the upstream source code and all files created for the debian package (usually has a .debian.tar.gz or .diff.gz ending).</p>
<p>3). Binary packages - what actually get installed on a user's system.</p>
<p>You usually have to get the upstream tarball from some developers who are working on a piece of software. (You type <code>sudo apt-get source &lt;package-name&gt;</code> in order to fetch it).</p>
<p>In this case, however, the upstream tarball will be created by you.</p>
<p>Therefore, there is no need to get an upstream tarball. You'll create one yourself!</p>
<p>Follow these steps:</p>
<p>1). Create a new folder and call it "tsgl-***version-number***", replacing ***version-number*** with whatever version TSGL is currently.</p>
<p>(If you've made changes to the library recently, bump up the middle number of the version number by one. i.e. 1.1.1 -&gt; 1.2.1). (If not, make no changes to the version number).</p>
<p>2). Go to wherever you have the TSGL folder (which you can get using git if you don't have it: git clone <a href="https://www.github.com/Calvin-CS/TSGL.git">https://www.github.com/Calvin-CS/TSGL.git</a>).</p>
<p>3). Take ALL of the files in the TSGL folder, and copy them over to the tsgl-***version-number*** folder.</p>
<p>Okay, now we'll create the actual upstream tarball.</p>
<p>1). Open up a terminal, and go to the place where the tsgl-***version-number*** folder is located.</p>
<p>2). Type</p>
<p>``` </p>
<pre class="fragment">tar czvf tsgl-&lt;version-number&gt;.tar.gz tsgl-&lt;version-number&gt;
</pre><p>```</p>
<p>3). Type <code>ls</code>, and you should see files that look like this:</p>
<p>``` </p>
<pre class="fragment">tsgl-&lt;version-number&gt;.tar.gz tsgl-&lt;version-number&gt; 
</pre><p>```</p>
<p>Congrats! You created the upstream tarball, and have taken your first step in making a Debian package. </p>
<hr/>
 <h2>| Creating Debian packages: files, files, and more files | </h2>
<p>Now that you have the upstream tarball created, it's time to get into the nitty gritty details of Debian packaging.</p>
<p>We'll go into preparing the library so that it can be packaged up.</p>
<p>You know how you have to prepare a turkey before actually cooking it?</p>
<p>The process is somewhat similar when creating a Debian package.</p>
<p>Go into the tsgl-***version-number*** folder after creating the upstream tarball. Create a folder named <code>debian</code>.</p>
<p>This one folder, <code>debian</code>, will store all of the necessary files needed in order to create a <code>debian</code> package.</p>
<p>And quite a lot of files we need....</p>
<ul>
<li>changelog</li>
<li>control</li>
<li>rules</li>
<li>compat</li>
<li>tsgl.install</li>
<li>copyright</li>
<li>source/format</li>
<li>preinst</li>
<li>postinst</li>
</ul>
<p>There are more, but these will suffice.</p>
<p>You're going to have to create each and every one of these files.</p>
<p>Like we said, a bit more complicated than RPM package creation.</p>
<p>Let's get started with the <code>changelog</code> file. </p>
<hr/>
 <h2>| changelog file | </h2>
<p>This file essentially explains what has been changed in the Debian package. Ranging from a minor change to the control file (explained shortly), or a full scale rework of the entire package, you have to explain what you changed in this file.</p>
<p>Don't worry, you don't have to explain ***EVERY*** little detail. You only have to summarize your changes.</p>
<p>This file is also ***EXTREMELY*** picky in regards to format. There is a specific format for this file that <em>MUST</em> be followed.</p>
<p>Since you're creating a brand new package, we assume that the only thing that has been changed is the TSGL source code.</p>
<p>To create the <code>changelog</code> file, be in the tsgl-***version-number*** directory, and type this command:</p>
<p>``` </p>
<pre class="fragment">dch --create -v &lt;version-number&gt; --package tsgl
</pre><p><code> (If dch isn't installed, type</code>sudo apt-get install devscripts``` and repeat this step).</p>
<p>You'll be asked to pick an editor. Pick whichever one is the easiest one to use.</p>
<p>Now, you should see something like this:</p>
<p>```</p>
<p>tsgl (&lt;version-number-debnumber&gt;) UNRELEASED; urgency=medium</p>
<ul>
<li>Initial release. (Closes: #XXXXXX)</li>
</ul>
<p>&ndash; kodemonkey &lt;kodemonkey-desktop&gt; Mon, 06 Jun 2016 15:56:57 -0400</p>
<p>```</p>
<p>Let's break it down:</p>
<ul>
<li><code>tsgl (&lt;version-number-debnumber&gt;)</code> specifies the name of the package and the current version number. The <code>debnumber</code> tells us what version is the DEBIAN package. You can create multiple versions of the same package, without changing the source code of the package software. Usually this is when a new dependency needs to be added, or a new file needs to be added to the <code>debian</code> folder. In this case, since we are creating it, set this number to 1.</li>
</ul>
<p>If this were an already created package, and we didn't make any changes to the TSGL source code, but made changes to the <code>debian</code> files, we would have to add 1 to the <code>debnumber</code></p>
<ul>
<li><code>UNRELEASED</code> specifies the Linux distro that we developed the library for.</li>
</ul>
<p><code>trusty</code> is for <code>Ubuntu 14.04</code>, <code>xenial</code> is for <code>Ubuntu 16.04</code>.</p>
<p>If you are creating a new TSGL package for either one of those distros, replace <code>UNRELEASED</code> with the distro name.</p>
<p>If you are creating a new TSGL package for a new distro, ***NEW PAGE COMING SOON***</p>
<ul>
<li><code>urgency=medium</code> specifies the priority level for this package. You can leave it as is.</li>
<li><code>* Initial release.</code> specifies what has been changed in the library. You can leave it as is.</li>
<li>Remove the <code>(Closes: #XXXXXX)</code> as that is for bug fixes.</li>
<li><code>-- kodemonkey &lt;kodemonkey@kodemonkey-desktop&gt; Mon, 06 Jun 2016 15:56:57 -0400</code> specifies the person who made the changes (<code>kodemonkey</code>), an email that you can contact them by (<code>kodemonkey@kodemonkey-desktop</code>), and the time and date that the changes were made.</li>
</ul>
<p>You'll want to replace the name and email with your name and email.</p>
<p>You should end up with a file like this after changes have been made:</p>
<p>```</p>
<p>tsgl (1.0-1) trusty; urgency=medium</p>
<ul>
<li>Initial release.</li>
</ul>
<p>&ndash; Chris Dilley <a href="#" onclick="location.href='mai'+'lto:'+'cod'+'em'+'onk'+'ey'+'941'+'@g'+'mai'+'l.'+'com'; return false;">codem<span style="display: none;">.nosp@m.</span>onke<span style="display: none;">.nosp@m.</span>y941@<span style="display: none;">.nosp@m.</span>gmai<span style="display: none;">.nosp@m.</span>l.com</a> Mon, 06 Jun 2016 15:56:57 -0400</p>
<p>```</p>
<p>Save the changes and close the file. </p>
<hr/>
 <h2>| control file | </h2>
<p>This file tells apt-get how to manage the package.</p>
<p>It's also a real workhorse of a file.</p>
<p>Here's the general format:</p>
<p>```</p>
<p>1 Source: tsgl 2 Maintainer: Chris Dilley <a href="#" onclick="location.href='mai'+'lto:'+'cod'+'em'+'onk'+'ey'+'941'+'@g'+'mai'+'l.'+'com'; return false;">codem<span style="display: none;">.nosp@m.</span>onke<span style="display: none;">.nosp@m.</span>y941@<span style="display: none;">.nosp@m.</span>gmai<span style="display: none;">.nosp@m.</span>l.com</a> 3 Section: libs 4 Priority: optional 5 Standards-Version: 3.9.5 6 Build-Depends: debhelper (&gt;= 9), glfw, doxygen, libglew-dev, libglew1.10, libfreetype6-dev, libfreetype6, libxrandr-dev, libxi-dev, 7 x11proto-xf86vidmode-dev, libglu1-mesa-dev 8 9 Package: tsgl 10 Architecture: amd64 11 Depends: ${shlibs:Depends}, ${misc:Depends}, glfw, libfreetype6, libfreetype6-dev, libglew1.10, libglew-dev, libxrandr-dev, doxygen, devscripts, build-essential 12 Description: A Thread-Safe Graphics Library.</p>
<p>(Line numbers added)</p>
<p>```</p>
<p>As you can see, there are two sections. Lines 1-7 specify information for the source package, while lines 9-12 specify information for the binary package.</p>
<p>Let's break them down:</p>
<p>-&mdash;SOURCE-&mdash;</p>
<ul>
<li><code>Source</code> specifies the name of the source package.</li>
<li><code>Maintainer</code> specifies the person who is keeping track of the package in terms of updates, tweaks, etc.</li>
<li><code>Section</code> species the section of the distribution that the source package goes into (in this case, libs).</li>
<li><code>Priority</code> specifies the importance of this package.</li>
<li><code>Standards-Version</code> specifies the Debian standards for packaging that we are following.</li>
<li><code>Build-Depends</code> specifies what libraries need to be present in order to build our library.</li>
</ul>
<p>-&mdash;BINARY-&mdash;</p>
<ul>
<li><code>Package</code> specifies the name of the package. Note that the Source and Package name fields do NOT have to be the same.</li>
<li><code>Architecture</code> specifies the architectures that the binary package can be compiled for.</li>
<li><code>Depends</code> specifies what libraries need to be present in order for our binary package to behave correctly.</li>
<li><code>Description</code> specifies a short summary of what the package is.</li>
</ul>
<p>At the time of this writing, this was the control file for the <code>trusty</code> TSGL debian package.</p>
<p>The one for the <code>xenial</code> package is the same.</p>
<p>If nothing has changed (no new dependencies have been added...), simply copy and paste it into the new control file. Change the <code>Maintainer</code> field to your name and email.</p>
<p>Save the changes and close the file. </p>
<hr/>
 <h2>| compat file | </h2>
<p>This is the easiest file to make. Create the file, and type "9". Save the changes and don't touch the file again.</p>
<p>Essentially, all this file does is tell the packaging tools to use debhelper version 9.</p>
<p>This means, "Use the tools which help build Debian packages from version 9." </p>
<hr/>
 <h2>| rules file | </h2>
<p>This file tells the build system how to make the binary package (in this case, the one that will be built in our ppa after we upload the source package).</p>
<p>As mentioned above, there are three components to a Debian package: upstream tarball, source package, and binary package.</p>
<p>We've already made the upstream tarball.</p>
<p>Our source and binary packages, however, will be made for us.</p>
<p>The source package will be made as a result of the work done in the next section.</p>
<p>The PPA has a build system which takes our uploaded source package and creates a binary package out of that.</p>
<p>It then publishes the upstream tarball, source package, and binary packages so that users can download and install tsgl.</p>
<p>You can upload binaries, though it is NOT recommended.</p>
<p>At any rate, this is what the rules files looks like for both the trusty and xenial packages:</p>
<hr/>
 <h2>| tsgl.install file | </h2>
<p>This file explains where files need to go when the package is being installed.</p>
<p>Whenever something is installed on a user's system, certain files need to go to certain places.</p>
<p>An example would be an executable. Normally, you put executables inside of a user's /usr/bin when it is being installed.</p>
<p>This file specifies where certain files go on a user's system.</p>
<p>In our case, we need to put the libtsgl.so (and libtsgl.a file if created) into /usr/lib/, the .h files from src/TSGL into /usr/include/TSGL/, and the generic Makefile into /usr/include/TSGLMAKE/ (so users can create programs with TSGL with ease).</p>
<hr/>
 <h2>| source/format | </h2>
<hr/>
 <h2>| copyright | </h2>
<p>This file is used to store licensing information and legal stuff associated with your software.</p>
<p>In much the same way as inventors patent their products in order to protect them, software developers use licenses in order to protect their software.</p>
<p>"Protection" means not having your ideas stolen, etc.</p>
<p>It's essentially a way of telling everyone, "This software is availible for use, but with some restrictions."</p>
<p>In the case of TSGL, we use the GPL v3 license.</p>
<p>This is located in the TSGL main folder, in a file called, "license".</p>
<p>Simply open that file up, copy the contents, and paste them into the copyright file. </p>
<hr/>
 <h2>| preinst | </h2>
<p>This file is usually a shell/bash script that is executed ***before*** the installation of the package.</p>
<p>You can do all sorts of things with this file, ranging from checking library versions, to making sure that everything is in place for installing your package.</p>
<p>In the case of TSGL, we use this file to check the OpenGL version.</p>
<p>It <em>MUST</em> be 3.0 or greater, because TSGL relies on functions that were implemented in OpenGL 3.0 and greater.</p>
<p>To check the OpenGL version, one method that we used was:</p>
<p>```</p>
<p>#!/bin/sh</p>
<p>versInfo=$(glxinfo | grep OpenGL)</p>
<p>#http://stackoverflow.com/questions/18147884/shell-variable-in-a-grep-regex #Get the OpenGL version string check="OpenGL version string: " versString=$(echo "$versInfo" | grep "$check")</p>
<p>#http://stackoverflow.com/questions/7516455/sed-extract-version-number-from-string-only-version-without-other-numbers #http://superuser.com/questions/363865/how-to-extract-a-version-number-using-sed #Extract the version number versNum=$(echo "$versString" | sed 's/[^0-9.]*([0-9.]*).*/\1/')</p>
<p>#http://tldp.org/LDP/abs/html/comparison-ops.html #Check if the OpenGL version number is 3.0 or greater. if [[ "$versNum" &lt; "3.0" ]] then exit 1 fi</p>
<p>```</p>
<p>Simply copy and paste the code above into the preinst file, save and then close it. </p>
<hr/>
 <h2>| postinst | </h2>
<p>This file is usually a shell/bash script that is executed ***after*** the installation of the package.</p>
<p>Whew, that was a lot of files!</p>
<p>Let's move onto the easiest part of Debian package creation: actually creating one! </p>
<hr/>
 <h2>| Creating Debian packages: debuild is your friend | </h2>
<p>So, you have created all of the files in the debian folder.</p>
<p>Now all that's left to do is to create the files needed in order to create our full Debian package and upload said package.</p>
<p>You'll also have to sign the package (so Debian knows that you made the package) with a GPG key, located in keyID.txt.</p>
<p>How do we do all that?</p>
<p>debuild.</p>
<p>debuild creates our Debian package and files needed in order to upload said package.</p>
<p>Simply type: </p>
<pre class="fragment">cd ../
debuild -S -rfakeroot -k&lt;key-id&gt; (replacing &lt;key-id&gt; with the key ID located in key.txt). 
</pre><p>and debuild takes care of the rest!</p>
<p>debuild -S -rfakeroot -k&lt;key-id&gt; cd .. ls &lt;package-name&gt;.source_changes </p>
<hr/>
 <h2>| MISC | </h2>
<p>Does something not make sense? Have we missed something? Take a look at these links for more information.</p>
<p><a href="https://wiki.debian.org/Packaging/Intro?action=show&redirect=IntroDebianPackaging">https://wiki.debian.org/Packaging/Intro?action=show&amp;redirect=IntroDebianPackaging</a></p>
<p><a href="https://en.wikipedia.org/wiki/Upstream_%28software_development%29">https://en.wikipedia.org/wiki/Upstream_%28software_development%29</a></p>
<p><a href="https://wiki.debian.org/Packaging/SourcePackage?action=show&redirect=SourcePackage">https://wiki.debian.org/Packaging/SourcePackage?action=show&amp;redirect=SourcePackage</a></p>
<p><a href="https://www.debian.org/doc/manuals/maint-guide/dreq.en.html">https://www.debian.org/doc/manuals/maint-guide/dreq.en.html</a></p>
<p><a href="https://www.debian.org/doc/manuals/maint-guide/dreq.en.html#control">https://www.debian.org/doc/manuals/maint-guide/dreq.en.html#control</a></p>
<p><a href="https://wiki.debian.org/Packaging/SourcePackage?action=show&redirect=SourcePackage#Working_with_a_source_package">https://wiki.debian.org/Packaging/SourcePackage?action=show&amp;redirect=SourcePackage#Working_with_a_source_package</a></p>
<p>***PLEASE*** update this document if you come across new links, or if there's missing/false information. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Aug 5 2016 16:29:08 for TSGL by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
